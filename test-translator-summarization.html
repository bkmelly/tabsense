<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TabSense Translator API Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2em;
        }
        .test-section {
            margin: 25px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
        }
        .test-section h2 {
            color: #4a5568;
            margin-top: 0;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .result {
            background: #f0f8ff;
            border: 1px solid #b0d4f1;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .error {
            background: #ffe6e6;
            border: 1px solid #ffb3b3;
            color: #d00;
        }
        .success {
            background: #e6ffe6;
            border: 1px solid #b3ffb3;
            color: #060;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .sample-text {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Georgia', serif;
            line-height: 1.6;
        }
        .api-status {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-available {
            background: #28a745;
        }
        .status-unavailable {
            background: #dc3545;
        }
        .status-unknown {
            background: #6c757d;
        }
        .step-indicator {
            background: #e9ecef;
            border-radius: 20px;
            padding: 5px 15px;
            margin: 10px 0;
            font-weight: bold;
            color: #495057;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåê Chrome Translator API Test</h1>
        
        <div class="test-section">
            <h2>üîç 1. Check Chrome AI APIs</h2>
            <button onclick="checkChromeAPIs()">Check Available APIs</button>
            <div id="apiStatusResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>üìù 2. Test Translator API Directly</h2>
            <button onclick="testTranslatorDirect()">Test Translator API</button>
            <div id="translatorResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>üìÑ 3. Test Summarization via Translator</h2>
            <div class="sample-text">
                <strong>Sample Text for Summarization:</strong><br><br>
                Artificial intelligence (AI) has revolutionized numerous industries and continues to shape our daily lives in profound ways. From healthcare and finance to transportation and entertainment, AI technologies are being integrated into systems that were previously unimaginable. Machine learning algorithms can now process vast amounts of data to identify patterns, make predictions, and automate complex decision-making processes. Natural language processing enables computers to understand and generate human language, powering chatbots, translation services, and content creation tools. Computer vision allows machines to interpret and analyze visual information, enabling applications like facial recognition, autonomous vehicles, and medical image analysis. As AI continues to advance, it presents both incredible opportunities and significant challenges, including questions about ethics, privacy, job displacement, and the need for responsible development and deployment of these powerful technologies.
            </div>
            <button onclick="testSummarizationViaTranslator()">Summarize via Translator</button>
            <div id="summarizationResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>üåç 4. Test Translation Functionality</h2>
            <button onclick="testTranslation()">Test Translation</button>
            <div id="translationResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>üîß 5. Test Extension Integration</h2>
            <button onclick="testExtensionSummarization()">Test Extension Summarization</button>
            <div id="extensionResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>üìä 6. Performance Analysis</h2>
            <button onclick="analyzePerformance()">Analyze Performance</button>
            <div id="performanceResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Test functions
        async function checkChromeAPIs() {
            const resultDiv = document.getElementById('apiStatusResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'Checking Chrome AI APIs...';

            try {
                let status = 'Chrome AI API Status:\n\n';
                
                // Check Summarizer
                if (typeof Summarizer !== 'undefined') {
                    try {
                        const summarizerAvailability = await Summarizer.availability();
                        status += `‚úÖ Summarizer: ${summarizerAvailability}\n`;
                    } catch (error) {
                        status += `‚ùå Summarizer: Error - ${error.message}\n`;
                    }
                } else {
                    status += `‚ùå Summarizer: Not available\n`;
                }

                // Check Prompt
                if (typeof Prompt !== 'undefined') {
                    try {
                        const promptAvailability = await Prompt.availability();
                        status += `‚úÖ Prompt: ${promptAvailability}\n`;
                    } catch (error) {
                        status += `‚ùå Prompt: Error - ${error.message}\n`;
                    }
                } else {
                    status += `‚ùå Prompt: Not available\n`;
                }

                // Check Translator
                if (typeof Translator !== 'undefined') {
                    try {
                        const translatorAvailability = await Translator.availability();
                        status += `‚úÖ Translator: ${translatorAvailability}\n`;
                    } catch (error) {
                        status += `‚ùå Translator: Error - ${error.message}\n`;
                    }
                } else {
                    status += `‚ùå Translator: Not available\n`;
                }

                // Check Language Detector
                if (typeof LanguageDetector !== 'undefined') {
                    try {
                        const detectorAvailability = await LanguageDetector.availability();
                        status += `‚úÖ Language Detector: ${detectorAvailability}\n`;
                    } catch (error) {
                        status += `‚ùå Language Detector: Error - ${error.message}\n`;
                    }
                } else {
                    status += `‚ùå Language Detector: Not available\n`;
                }

                resultDiv.className = 'result success';
                resultDiv.textContent = status;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå Error checking APIs: ${error.message}`;
            }
        }

        async function testTranslatorDirect() {
            const resultDiv = document.getElementById('translatorResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'Testing Translator API directly...';

            try {
                if (typeof Translator === 'undefined') {
                    throw new Error('Translator API not available');
                }

                const availability = await Translator.availability();
                if (availability !== 'available') {
                    throw new Error(`Translator not available: ${availability}`);
                }

                const translator = await Translator.create();
                const testText = "Hello, this is a test of the Chrome Translator API.";
                const result = await translator.translate(testText, 'es'); // Translate to Spanish

                resultDiv.className = 'result success';
                resultDiv.textContent = `‚úÖ Translator API Test:
Original: ${testText}
Translated: ${result}
Availability: ${availability}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå Translator API Error: ${error.message}`;
            }
        }

        async function testSummarizationViaTranslator() {
            const resultDiv = document.getElementById('summarizationResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'Testing summarization via Translator API...';

            try {
                if (typeof Translator === 'undefined') {
                    throw new Error('Translator API not available');
                }

                const availability = await Translator.availability();
                if (availability !== 'available') {
                    throw new Error(`Translator not available: ${availability}`);
                }

                const translator = await Translator.create();
                const longText = document.querySelector('.sample-text').textContent.replace('Sample Text for Summarization:', '').trim();
                
                // Create a summarization prompt using translation
                const summarizationPrompt = `Summarize this text in fewer words: ${longText}`;
                
                const result = await translator.translate(summarizationPrompt, 'en');

                resultDiv.className = 'result success';
                resultDiv.textContent = `‚úÖ Summarization via Translator:
Original Length: ${longText.length} characters
Summary Length: ${result.length} characters
Compression Ratio: ${((1 - result.length / longText.length) * 100).toFixed(1)}%

Summary: ${result}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå Summarization Error: ${error.message}`;
            }
        }

        async function testTranslation() {
            const resultDiv = document.getElementById('translationResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'Testing translation functionality...';

            try {
                if (typeof Translator === 'undefined') {
                    throw new Error('Translator API not available');
                }

                const availability = await Translator.availability();
                if (availability !== 'available') {
                    throw new Error(`Translator not available: ${availability}`);
                }

                const translator = await Translator.create();
                const testText = "Artificial intelligence is transforming the world.";
                
                const translations = {
                    'Spanish': await translator.translate(testText, 'es'),
                    'French': await translator.translate(testText, 'fr'),
                    'German': await translator.translate(testText, 'de'),
                    'Chinese': await translator.translate(testText, 'zh')
                };

                let result = `‚úÖ Translation Test:\nOriginal: ${testText}\n\nTranslations:\n`;
                Object.entries(translations).forEach(([lang, translation]) => {
                    result += `${lang}: ${translation}\n`;
                });

                resultDiv.className = 'result success';
                resultDiv.textContent = result;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå Translation Error: ${error.message}`;
            }
        }

        async function testExtensionSummarization() {
            const resultDiv = document.getElementById('extensionResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'Testing extension summarization...';

            try {
                const testText = "This is a comprehensive test of the TabSense extension's summarization capabilities using the Chrome Translator API as a fallback method.";
                
                const response = await chrome.runtime.sendMessage({
                    action: 'SUMMARIZE_TEXT',
                    payload: {
                        text: testText,
                        options: { maxLength: 'medium' }
                    }
                });

                if (response.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `‚úÖ Extension Summarization Test:
Original: ${testText}
Original Length: ${response.data.originalLength} characters
Summary: ${response.data.summary}
Summary Length: ${response.data.summaryLength} characters
Compression: ${((1 - response.data.summaryLength / response.data.originalLength) * 100).toFixed(1)}%
Timestamp: ${new Date(response.data.timestamp).toLocaleString()}`;
                } else {
                    throw new Error(response.error);
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå Extension Error: ${error.message}`;
            }
        }

        async function analyzePerformance() {
            const resultDiv = document.getElementById('performanceResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'Analyzing performance...';

            try {
                const testTexts = [
                    "Short text for testing.",
                    "This is a medium-length text that contains more information and should provide a better test of the summarization capabilities of the Chrome Translator API.",
                    "This is a much longer text that contains extensive information about various topics including technology, science, and society. It should provide a comprehensive test of the summarization capabilities and help us understand how well the Chrome Translator API performs when asked to summarize complex content with multiple sentences and detailed information."
                ];

                let results = 'üìä Performance Analysis:\n\n';
                
                for (let i = 0; i < testTexts.length; i++) {
                    const text = testTexts[i];
                    const startTime = performance.now();
                    
                    try {
                        const response = await chrome.runtime.sendMessage({
                            action: 'SUMMARIZE_TEXT',
                            payload: {
                                text: text,
                                options: { maxLength: 'medium' }
                            }
                        });
                        
                        const endTime = performance.now();
                        const duration = (endTime - startTime).toFixed(2);
                        
                        if (response.success) {
                            const compression = ((1 - response.data.summaryLength / response.data.originalLength) * 100).toFixed(1);
                            results += `Test ${i + 1} (${text.length} chars):
Duration: ${duration}ms
Compression: ${compression}%
Summary: ${response.data.summary}
\n`;
                        } else {
                            results += `Test ${i + 1}: Error - ${response.error}\n\n`;
                        }
                    } catch (error) {
                        results += `Test ${i + 1}: Error - ${error.message}\n\n`;
                    }
                }

                resultDiv.className = 'result success';
                resultDiv.textContent = results;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå Performance Analysis Error: ${error.message}`;
            }
        }

        // Auto-run API check on load
        window.addEventListener('load', () => {
            setTimeout(checkChromeAPIs, 1000);
        });
    </script>
</body>
</html>
